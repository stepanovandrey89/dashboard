(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();class L{constructor(){this.farms=[],this.rigIds=[],this.offlineThreshold=15*60*1e3,this.selectedFarm=null,this.coreTemperatureThreshold=85,this.memoryTemperatureThreshold=95}setOfflineThreshold(e){this.offlineThreshold=e}setCoreTemperatureThreshold(e){this.coreTemperatureThreshold=e}setMemoryTemperatureThreshold(e){this.memoryTemperatureThreshold=e}async loadFarms(){try{const e=await fetch("data/rig_ids.json");this.rigIds=await e.json();const t=this.rigIds.map(n=>this.loadFarmData(n)),s=await Promise.all(t);this.farms=s.filter(n=>n!==null),this.renderFarmsTable()}catch(e){throw console.error("Ошибка загрузки ферм:",e),e}}async loadFarmData(e){try{const t=await fetch(`data/hello_${e.id}.json`);if(!t.ok)throw new Error(`HTTP ${t.status}`);const s=await t.json();let n=null,a=!1,i=new Date;try{const o=await fetch(`data/stats_${e.id}.json`);if(o.ok){n=await o.json();const r=o.headers.get("last-modified");r?i=new Date(r):i=new Date(Date.now()-5*60*1e3),a=Date.now()-i.getTime()<=this.offlineThreshold}}catch(o){console.warn(`Нет stats данных для фермы ${e.id}:`,o.message),a=!1}return this.processFarmData(e,s,n,a,i)}catch(t){return console.error(`Ошибка загрузки данных фермы ${e.id}:`,t),null}}processFarmData(e,t,s,n,a){const i=t.params.gpu.filter(d=>d.brand!=="intel"&&d.brand!=="cpu"),o=n?this.calculateHashrate(s):0,r=n?this.calculatePower(s):0,c=this.calculateUptime(t.params.boot_time),l=n?this.getSolutions(s):0;return{id:e.id,name:e.name,isOnline:n,lastModified:a,gpuCount:i.length,gpus:i,hashrate:o,power:r,uptime:c,solutions:l,temperature:n?this.getAverageTemperature(s):0,helloData:t,statsData:s,notificationShown:!1}}calculateHashrate(e){var n,a;if(!e||!((n=e.params.miner_stats)!=null&&n.hs))return 0;let t=e.params.miner_stats.hs.reduce((i,o)=>i+(o||0),0);const s=((a=e.params.miner)==null?void 0:a.toLowerCase())||"";return s.includes("rigel")?t*=1024:(s.includes("custom")&&e.params.miner_stats.hs_units==="hs"||e.params.miner_stats.hs_units==="hs")&&(t=t),t}calculatePower(e){return e?(e.params.power||[]).filter(s=>s!==0).reduce((s,n)=>s+n,0):0}calculateUptime(e){return Math.floor((Date.now()-e*1e3)/1e3)}getAverageTemperature(e){var n;if(!e)return 0;const s=(((n=e.params.miner_stats)==null?void 0:n.temp)||[]).filter(a=>a>0);return s.length>0?Math.round(s.reduce((a,i)=>a+i,0)/s.length):0}getSolutions(e){var t,s;return e&&((s=(t=e.params.miner_stats)==null?void 0:t.ar)==null?void 0:s[0])||0}renderFarmsTable(e="farms-tbody-overview",t=!0){const s=document.getElementById(e);s&&(s.innerHTML="",this.farms.forEach(n=>{const a=this.createFarmRow(n,t);s.appendChild(a)}))}createFarmRow(e,t=!0){const s=document.createElement("tr");s.dataset.farmId=e.id;const n=e.isOnline?"online":"offline",a=e.isOnline?"Online":"Offline",i=e.gpus.map(r=>`<span class="gpu-indicator ${r.brand}" title="${r.name}"></span>`).join("");let o="";return e.isOnline&&e.hashrate>0&&(e.hashrate>1e3?o=(e.hashrate/1e3).toFixed(2)+" MH/s":o=e.hashrate.toFixed(2)+" H/s"),s.innerHTML=`
            <td>
                <div class="farm-status">
                    <span class="status-dot ${n}"></span>
                    <span>${a}</span>
                </div>
            </td>
            <td class="farm-name">${e.name}</td>
            <td>
                <div class="gpu-indicators">
                    ${i}
                </div>
            </td>
            <td>${e.isOnline?this.formatUptime(e.uptime):""}</td>
            <td>${e.isOnline?e.solutions.toLocaleString():""}</td>
            <td>${o}</td>
            <td>${e.isOnline?e.power+" W":""}</td>
        `,t&&(s.addEventListener("click",()=>{this.selectFarm(e)}),s.style.cursor="pointer"),s}selectFarm(e){document.querySelectorAll(".farms-table tr").forEach(s=>{s.classList.remove("active")});const t=document.querySelector(`tr[data-farm-id="${e.id}"]`);t&&t.classList.add("active"),this.selectedFarm=e,this.showFarmDetails(e)}showFarmDetails(e){const t=document.getElementById("farm-details"),s=document.getElementById("details-title");s.textContent=`Детали фермы ${e.name}`,e.isOnline?this.renderOnlineFarmDetails(e):this.renderOfflineFarmDetails(e),t.style.display="block",t.scrollIntoView({behavior:"smooth"})}renderOnlineFarmDetails(e){document.getElementById("offline-status").style.display="none",document.querySelector(".gpu-table-container").style.display="block",document.querySelector(".system-info").style.display="block",this.renderGPUTable(e),this.renderSystemInfo(e)}renderOfflineFarmDetails(e){const t=document.getElementById("offline-status"),s=document.getElementById("offline-message"),n=Date.now()-e.lastModified.getTime(),a=this.formatUptime(Math.floor(n/1e3));s.textContent=`Последнее обновление: ${a} назад`,t.style.display="block",document.querySelector(".gpu-table-container").style.display="none",document.querySelector(".system-info").style.display="none"}renderGPUTable(e){const t=document.getElementById("gpu-details-tbody");if(!t)return;t.innerHTML="";const s=this.createBusMapping(e.statsData,e.gpus);e.gpus.forEach((n,a)=>{var T,w,b,I,E,S;const i=s[n.busid]||{};let o="0.00",r="MH/s";if(i.hashrate&&i.hashrate!=="N/A"){let u=parseFloat(i.hashrate);const M=((T=e.statsData.params.miner)==null?void 0:T.toLowerCase())||"";M.includes("rigel")?(u*=1024,o=(u/1e3).toFixed(2),r="MH/s"):M.includes("custom")?(o=u.toFixed(2),r="H/s"):(o=(u/1e3).toFixed(2),r="MH/s")}let c="N/A",l="N/A",d="N/A";(((w=e.statsData.params.miner)==null?void 0:w.toLowerCase())||"").includes("onezerominer")?(c=((b=e.statsData.params.temp)==null?void 0:b[a+1])||"N/A",l=((I=e.statsData.params.mtemp)==null?void 0:I[a+1])||"N/A",d=((E=e.statsData.params.fan)==null?void 0:E[a+1])||"N/A"):(c=i.temp||"N/A",l=((S=e.statsData.params.mtemp)==null?void 0:S[a+1])||"N/A",d=i.fan||"N/A");const $=i.power||"N/A",F=Math.ceil(parseInt(n.mem)/1024),x=`${n.name} ${F}GB ${n.mem_type} (${n.subvendor})`;let h="";const f=parseFloat(c),g=parseFloat(l);(!isNaN(f)&&f>=this.coreTemperatureThreshold||!isNaN(g)&&g>=this.memoryTemperatureThreshold)&&(h="critical-temp");let y="0%";d!=="N/A"&&d!=="0"&&d!==0&&(y=d+"%");const v=document.createElement("tr");v.innerHTML=`
                <td>${a}</td>
                <td class="${n.brand} gpu-name">${x}</td>
                <td>${o} ${r}</td>
                <td><span class="${h}">${c}°C / ${l}°C</span></td>
                <td>${y}</td>
                <td>${$}W</td>
            `,t.appendChild(v)})}renderSystemInfo(e){const t=document.getElementById("system-info-grid");if(!t)return;const s=e.helloData.params,n=e.statsData.params;t.innerHTML=`
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="circuit-board"></i>
                </div>
                <div class="info-content">
                    <span class="label">Материнская плата:</span>
                    <span class="value">${s.mb.manufacturer} ${s.mb.product}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="cpu"></i>
                </div>
                <div class="info-content">
                    <span class="label">Процессор:</span>
                    <span class="value">${s.cpu.model}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="layers"></i>
                </div>
                <div class="info-content">
                    <span class="label">Количество ядер:</span>
                    <span class="value">${s.cpu.cores}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="hard-drive"></i>
                </div>
                <div class="info-content">
                    <span class="label">Накопитель:</span>
                    <span class="value">${s.disk_model}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="monitor"></i>
                </div>
                <div class="info-content">
                    <span class="label">Драйвер NVIDIA:</span>
                    <span class="value">${s.nvidia_version}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="monitor"></i>
                </div>
                <div class="info-content">
                    <span class="label">Драйвер AMD:</span>
                    <span class="value">${s.amd_version}</span>
                </div>
            </div>
            <div class="info-item">
                <div class="info-icon">
                    <i data-lucide="pickaxe"></i>
                </div>
                <div class="info-content">
                    <span class="label">Майнер:</span>
                    <span class="value">${this.getMinerInfo(n)}</span>
                </div>
            </div>
        `,typeof lucide<"u"&&lucide.createIcons()}createBusMapping(e,t){const s={},n=(e.params.power||[]).filter(a=>a!==0);return(e.params.miner_stats.bus_numbers||[]).forEach((a,i)=>{var r,c,l;const o=this.busNumberToBusid(a);s[o]={temp:((r=e.params.miner_stats.temp)==null?void 0:r[i])||"N/A",fan:((c=e.params.miner_stats.fan)==null?void 0:c[i])||"N/A",power:n[i]||"N/A",hashrate:((l=e.params.miner_stats.hs)==null?void 0:l[i])||0}}),s}busNumberToBusid(e){return`0${e.toString(16)}:00.0`}getMinerInfo(e){if(!e.miner_stats)return"Unknown";const t=e.miner||"Unknown",s=e.miner_stats.ver||"Unknown",n=e.miner_stats.algo||"Unknown",a=this.formatUptime(e.miner_stats.uptime||0);return`${t} v${s}, Algo: ${n}, Uptime: ${a}`}formatUptime(e){const t=Math.floor(e/86400),s=Math.floor(e%(24*3600)/3600),n=Math.floor(e%3600/60),a=Math.floor(e%60),i=[];return t>0&&i.push(`${t}д`),s>0&&i.push(`${s}ч`),n>0&&i.push(`${n}м`),a>0&&t===0&&i.push(`${a}с`),i.join(" ")||"0с"}hideFarmDetails(){const e=document.getElementById("farm-details");e.style.display="none",document.querySelectorAll(".farms-table tr").forEach(t=>{t.classList.remove("active")}),this.selectedFarm=null}async updateFarms(){try{const e=this.rigIds.map(s=>this.loadFarmData(s)),t=await Promise.all(e);if(this.farms=t.filter(s=>s!==null),document.getElementById("overview-section").classList.contains("active")&&(this.renderFarmsTable("farms-tbody-overview",!0),this.selectedFarm)){const s=this.farms.find(n=>n.id===this.selectedFarm.id);s&&(this.selectedFarm=s,this.showFarmDetails(s))}}catch(e){console.error("Ошибка обновления ферм:",e)}}getFarms(){return this.farms}}class B{constructor(){this.container=document.getElementById("notifications-container"),this.notifications=[],this.maxNotifications=5,this.defaultDuration=5e3}show(e,t="info",s=this.defaultDuration){const n=this.createNotification(e,t,s);return this.addNotification(n),s>0&&setTimeout(()=>{this.removeNotification(n)},s),n}createNotification(e,t,s){const n=document.createElement("div");n.className=`notification ${t}`;const a=this.getIcon(t);return n.innerHTML=`
            <div class="notification-content">
                <div class="notification-icon">
                    <i data-lucide="${a}"></i>
                </div>
                <div class="notification-message">${e}</div>
                <button class="notification-close">
                    <i data-lucide="x"></i>
                </button>
            </div>
        `,n.querySelector(".notification-close").addEventListener("click",()=>{this.removeNotification(n)}),setTimeout(()=>{typeof lucide<"u"&&lucide.createIcons()},0),n}getIcon(e){const t={success:"check-circle",error:"alert-circle",warning:"alert-triangle",info:"info"};return t[e]||t.info}addNotification(e){for(;this.notifications.length>=this.maxNotifications;){const t=this.notifications.shift();this.removeNotification(t)}this.notifications.push(e),this.container.appendChild(e),requestAnimationFrame(()=>{e.style.transform="translateX(0)",e.style.opacity="1"})}removeNotification(e){e.parentNode&&(e.style.transform="translateX(100%)",e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e);const t=this.notifications.indexOf(e);t>-1&&this.notifications.splice(t,1)},300))}clear(){this.notifications.forEach(e=>{this.removeNotification(e)}),this.notifications=[]}success(e,t){return this.show(e,"success",t)}error(e,t){return this.show(e,"error",t)}warning(e,t){return this.show(e,"warning",t)}info(e,t){return this.show(e,"info",t)}}class D{constructor(){this.currentTheme=this.getStoredTheme()||"dark",this.applyTheme(this.currentTheme)}getStoredTheme(){return localStorage.getItem("mining-dashboard-theme")}setStoredTheme(e){localStorage.setItem("mining-dashboard-theme",e)}applyTheme(e){document.documentElement.setAttribute("data-theme",e),this.currentTheme=e,this.setStoredTheme(e)}toggle(){const e=this.currentTheme==="dark"?"light":"dark";return this.applyTheme(e),e}getCurrentTheme(){return this.currentTheme}isDark(){return this.currentTheme==="dark"}isLight(){return this.currentTheme==="light"}}class N{constructor(){this.coinIds=["bitcoin","ethereum","layerzero-bridged-sei","ripple","solana","dogecoin","popcat","apecoin","heima","space-id","official-trump","bitcoin-cash","monero","the-open-network","magic","ethereum-classic","mantra-dao","polkadot","xelis","dogwifcoin"],this.apiUrl="https://api.coingecko.com/api/v3/coins/markets"}async loadRates(){try{const e=new URLSearchParams({vs_currency:"usd",ids:this.coinIds.join(","),sparkline:!1}),s=await(await fetch(`${this.apiUrl}?${e}`)).json();this.renderRatesGrid(s)}catch(e){console.error("Ошибка загрузки курсов:",e),this.renderErrorState()}}renderRatesGrid(e){const t=document.getElementById("rates-grid");t&&(t.innerHTML="",e.forEach(s=>{const{image:n,symbol:a,name:i,current_price:o,price_change_percentage_24h:r,market_cap:c}=s,l=document.createElement("div");l.classList.add("rate-card");const d=r>=0?"positive":"negative",p=r>=0?"trending-up":"trending-down";l.innerHTML=`
                <div class="rate-header">
                    <img src="${n}" alt="${a} logo" class="coin-logo">
                    <div class="coin-info">
                        <div class="coin-name">${i}</div>
                        <div class="coin-symbol">${a.toUpperCase()}</div>
                    </div>
                </div>
                <div class="rate-price">$${o.toLocaleString()}</div>
                <div class="rate-change ${d}">
                    <i data-lucide="${p}"></i>
                    <span>${Math.abs(r||0).toFixed(2)}%</span>
                </div>
                <div class="rate-market-cap">
                    <span class="label">Market Cap:</span>
                    <span class="value">$${this.formatMarketCap(c)}</span>
                </div>
            `,t.appendChild(l)}),typeof lucide<"u"&&lucide.createIcons())}renderErrorState(){const e=document.getElementById("rates-grid");e&&(e.innerHTML=`
            <div class="error-state">
                <i data-lucide="wifi-off"></i>
                <h3>Ошибка загрузки курсов</h3>
                <p>Не удалось загрузить актуальные курсы криптовалют. Проверьте подключение к интернету.</p>
                <button class="retry-btn" onclick="window.dashboard.ratesManager.loadRates()">
                    <i data-lucide="refresh-cw"></i>
                    Попробовать снова
                </button>
            </div>
        `,typeof lucide<"u"&&lucide.createIcons())}formatMarketCap(e){return e?e>=1e12?(e/1e12).toFixed(2)+"T":e>=1e9?(e/1e9).toFixed(2)+"B":e>=1e6?(e/1e6).toFixed(2)+"M":e>=1e3?(e/1e3).toFixed(2)+"K":e.toLocaleString():"N/A"}}class C{constructor(){this.apiUrl="data/global_settings.json",this.updateUrl="api/update_settings.php",this.defaultSettings={coreTemperatureThreshold:85,memoryTemperatureThreshold:95}}async loadGlobalSettings(){try{const e=await fetch(this.apiUrl+"?t="+Date.now());if(e.ok){const t=await e.json();return{coreTemperatureThreshold:t.coreTemperatureThreshold||this.defaultSettings.coreTemperatureThreshold,memoryTemperatureThreshold:t.memoryTemperatureThreshold||this.defaultSettings.memoryTemperatureThreshold}}}catch(e){console.warn("Не удалось загрузить глобальные настройки:",e)}return this.defaultSettings}async saveGlobalSettings(e){try{console.log("Сохранение глобальных настроек через API:",e);const t=await fetch(this.updateUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({coreTemperatureThreshold:e.coreTemperatureThreshold,memoryTemperatureThreshold:e.memoryTemperatureThreshold})});if(t.ok){const s=await t.json();return console.log("Настройки успешно сохранены:",s),!0}else{const s=await t.json();return console.error("Ошибка сервера при сохранении:",s),!1}}catch(t){return console.error("Ошибка сохранения глобальных настроек:",t),!1}}async loadDemoGlobalSettings(){return await this.loadGlobalSettings()}}class A{constructor(){this.farmManager=new L,this.notificationManager=new B,this.themeManager=new D,this.ratesManager=new N,this.globalSettingsManager=new C,this.currentSection="overview",this.updateInterval=1e4,this.updateTimer=null,this.offlineThreshold=15*60*1e3,this.timeoutOptions=[15,30,60,120,240,480,720,1440],this.currentTimeoutIndex=0,this.allPayments=[],this.poolData=null,this.init()}async init(){try{typeof lucide<"u"&&lucide.createIcons(),this.setupNavigation(),this.setupMobileMenu(),this.setupThemeToggle(),this.setupOfflineTimeoutControl(),this.setupFarmDetails(),this.setupRates(),this.setupAlertSettings(),await this.loadGlobalTemperatureSettings(),await this.loadInitialData(),this.startAutoUpdate(),this.notificationManager.show("Дашборд успешно загружен","success")}catch(e){console.error("Ошибка инициализации:",e),this.notificationManager.show("Ошибка загрузки дашборда","error")}}setupMobileMenu(){const e=document.getElementById("mobile-menu-toggle"),t=document.getElementById("sidebar"),s=document.getElementById("sidebar-overlay");e&&t&&s&&(e.addEventListener("click",()=>{t.classList.toggle("open"),s.classList.toggle("active")}),s.addEventListener("click",()=>{t.classList.remove("open"),s.classList.remove("active")}),document.querySelectorAll(".nav-item").forEach(n=>{n.addEventListener("click",()=>{window.innerWidth<=1024&&(t.classList.remove("open"),s.classList.remove("active"))})}))}setupNavigation(){document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",s=>{s.preventDefault();const n=t.dataset.section;this.switchSection(n)})})}switchSection(e){document.querySelectorAll(".nav-item").forEach(t=>{t.classList.remove("active")}),document.querySelector(`[data-section="${e}"]`).classList.add("active"),document.querySelectorAll(".content-section").forEach(t=>{t.classList.remove("active")}),document.getElementById(`${e}-section`).classList.add("active"),this.updatePageTitle(e),this.loadSectionData(e),this.currentSection=e}updatePageTitle(e){const t={overview:"Обзор майнинга",rates:"Курсы криптовалют",earnings:"Доходы",payments:"История выплат",settings:"Настройки"},s={overview:"Мониторинг ваших майнинг ферм в реальном времени",rates:"Актуальные курсы криптовалют",earnings:"Отслеживание последних вознаграждений",payments:"Полная история всех выплат",settings:"Настройка параметров дашборда"};document.querySelector(".page-title").textContent=t[e],document.querySelector(".page-subtitle").textContent=s[e]}setupThemeToggle(){const e=document.getElementById("theme-toggle");e.addEventListener("click",()=>{this.themeManager.toggle();const t=e.querySelector("i"),s=this.themeManager.getCurrentTheme();t.setAttribute("data-lucide",s==="dark"?"sun":"moon"),typeof lucide<"u"&&lucide.createIcons()})}setupOfflineTimeoutControl(){const e=document.getElementById("timeout-decrease"),t=document.getElementById("timeout-increase");document.getElementById("timeout-value"),this.loadGlobalSettings(),this.updateTimeoutDisplay(),this.updateOfflineThreshold(),e.addEventListener("click",()=>{this.currentTimeoutIndex>0&&(this.currentTimeoutIndex--,this.updateTimeoutDisplay(),this.updateOfflineThreshold(),this.saveGlobalSettings())}),t.addEventListener("click",()=>{this.currentTimeoutIndex<this.timeoutOptions.length-1&&(this.currentTimeoutIndex++,this.updateTimeoutDisplay(),this.updateOfflineThreshold(),this.saveGlobalSettings())})}loadGlobalSettings(){const e=localStorage.getItem("local-offline-timeout");if(e){const t=this.timeoutOptions.indexOf(parseInt(e));t!==-1&&(this.currentTimeoutIndex=t)}}saveGlobalSettings(){const e=this.timeoutOptions[this.currentTimeoutIndex];localStorage.setItem("local-offline-timeout",e.toString())}updateTimeoutDisplay(){const e=document.getElementById("timeout-value"),t=document.getElementById("timeout-decrease"),s=document.getElementById("timeout-increase"),n=this.timeoutOptions[this.currentTimeoutIndex];n>=1440?e.textContent=`${n/1440} сут`:n>=60?e.textContent=`${n/60} ч`:e.textContent=`${n} мин`,t.disabled=this.currentTimeoutIndex===0,s.disabled=this.currentTimeoutIndex===this.timeoutOptions.length-1}updateOfflineThreshold(){const e=this.timeoutOptions[this.currentTimeoutIndex];this.offlineThreshold=e*60*1e3,this.farmManager.setOfflineThreshold(this.offlineThreshold),this.notificationManager.show(`Таймаут оффлайн установлен: ${document.getElementById("timeout-value").textContent}`,"info"),this.farmManager.updateFarms()}setupFarmDetails(){const e=document.getElementById("details-close");e&&e.addEventListener("click",()=>{this.farmManager.hideFarmDetails()})}setupRates(){const e=document.getElementById("refresh-rates");e&&e.addEventListener("click",()=>{this.ratesManager.loadRates(),this.notificationManager.show("Курсы обновлены","success")})}setupAlertSettings(){this.loadGlobalTemperatureSettings(),this.setupTemperatureInputs()}async loadGlobalTemperatureSettings(){try{const e=await this.globalSettingsManager.loadGlobalSettings();this.farmManager.setCoreTemperatureThreshold(e.coreTemperatureThreshold),this.farmManager.setMemoryTemperatureThreshold(e.memoryTemperatureThreshold);const t=document.getElementById("core-temp-threshold"),s=document.getElementById("memory-temp-threshold");t&&(t.value=e.coreTemperatureThreshold),s&&(s.value=e.memoryTemperatureThreshold)}catch(e){console.error("Ошибка загрузки глобальных настроек температур:",e)}}setupTemperatureInputs(){const e=document.getElementById("core-temp-threshold"),t=document.getElementById("memory-temp-threshold");e&&e.addEventListener("change",async s=>{const n=parseInt(s.target.value);this.farmManager.setCoreTemperatureThreshold(n);const a=await this.globalSettingsManager.loadGlobalSettings();a.coreTemperatureThreshold=n,await this.globalSettingsManager.saveGlobalSettings(a)?this.notificationManager.show(`Критическая температура ядра установлена глобально: ${n}°C`,"success"):this.notificationManager.show("Ошибка сохранения глобальных настроек","error")}),t&&t.addEventListener("change",async s=>{const n=parseInt(s.target.value);this.farmManager.setMemoryTemperatureThreshold(n);const a=await this.globalSettingsManager.loadGlobalSettings();a.memoryTemperatureThreshold=n,await this.globalSettingsManager.saveGlobalSettings(a)?this.notificationManager.show(`Критическая температура памяти установлена глобально: ${n}°C`,"success"):this.notificationManager.show("Ошибка сохранения глобальных настроек","error")})}async loadInitialData(){try{await this.farmManager.loadFarms(),await this.loadPoolData(),this.updateOverviewStats()}catch(e){throw console.error("Ошибка загрузки данных:",e),e}}async loadPoolData(){try{const e=await fetch("data/pool.json");this.poolData=await e.json(),document.getElementById("coin-symbol").textContent=this.poolData.pool.coinSymbol,document.getElementById("coin-price").textContent=`$${parseFloat(this.poolData.pool.coinPriceUsd).toFixed(2)}`,document.getElementById("blocks-found").textContent=this.poolData.miner.totalBlocksFound,document.getElementById("coin-symbol-earnings").textContent=this.poolData.pool.coinSymbol,document.getElementById("coin-price-earnings").textContent=`$${parseFloat(this.poolData.pool.coinPriceUsd).toFixed(2)}`,document.getElementById("coin-symbol-payments").textContent=this.poolData.pool.coinSymbol,document.getElementById("coin-price-payments").textContent=`$${parseFloat(this.poolData.pool.coinPriceUsd).toFixed(2)}`,this.updateRewardsTable(this.poolData),this.allPayments=this.poolData.miner.payments,this.updateAllPaymentsTable()}catch(e){console.error("Ошибка загрузки данных пула:",e)}}updateRewardsTable(e){const t=document.getElementById("rewards-tbody");if(!t)return;const s=[{label:"Последние 60 минут",index:0},{label:"Последние 12 часов",index:1},{label:"Последние 24 часа",index:2},{label:"Сегодня",index:3},{label:"Вчера",index:4},{label:"Предыдущие 7 дней",index:5},{label:"Предыдущие 30 дней",index:6}];t.innerHTML="",s.forEach(n=>{var c;const a=((c=e.miner.sumrewards[n.index])==null?void 0:c.reward)||0,i=(a/1e8).toFixed(5),o=(a/1e8*parseFloat(e.pool.coinPriceUsd)).toFixed(2),r=document.createElement("tr");r.innerHTML=`
                <td>${n.label}</td>
                <td>${i}</td>
                <td>$${o}</td>
            `,t.appendChild(r)})}updateAllPaymentsTable(){const e=document.getElementById("all-payments-tbody"),t=document.getElementById("payments-total");if(!e||!this.poolData)return;e.innerHTML="",this.allPayments.forEach(a=>{const i=document.createElement("tr"),o=new Date(a.timestamp*1e3).toLocaleString("ru-RU"),r=(a.amount/1e8).toFixed(5);i.innerHTML=`
                <td>${o}</td>
                <td class="tx-hash">${a.tx}</td>
                <td>${r}</td>
            `,e.appendChild(i)});const s=this.allPayments.reduce((a,i)=>a+i.amount/1e8,0),n=s*parseFloat(this.poolData.pool.coinPriceUsd);t.innerHTML=`
            <div class="label">Итого выплачено:</div>
            <div class="value">${s.toFixed(2)} XEL ($${n.toFixed(2)})</div>
        `,typeof lucide<"u"&&lucide.createIcons()}updateOverviewStats(){const e=this.farmManager.getFarms(),t=e.filter(l=>l.isOnline),s=e.filter(l=>!l.isOnline),n=t.reduce((l,d)=>l+d.gpuCount,0),a=t.reduce((l,d)=>l+d.hashrate,0),i=t.reduce((l,d)=>l+d.power,0);document.getElementById("farms-count").textContent=t.length;const o=document.getElementById("offline-farms-count");s.length>0?(o.textContent=`${s.length} неактивных`,o.style.display="block"):o.style.display="none",document.getElementById("gpu-count").textContent=n;const r=document.getElementById("hashrate");a>1e3?(r.textContent=(a/1e3).toFixed(2),r.setAttribute("data-unit","MH/s")):(r.textContent=a.toFixed(2),r.setAttribute("data-unit","H/s"));const c=document.getElementById("power-consumption");c.textContent=(i/1e3).toFixed(2),c.setAttribute("data-unit","kW"),s.length>0&&s.forEach(l=>{l.notificationShown||(this.notificationManager.show(`Ферма ${l.name} не в сети`,"warning"),l.notificationShown=!0)}),this.farmManager.renderFarmsTable("farms-tbody-overview",!0)}async loadSectionData(e){switch(e){case"overview":this.updateOverviewStats();break;case"rates":await this.ratesManager.loadRates();break;case"earnings":this.poolData&&this.updateRewardsTable(this.poolData);break;case"payments":this.updateAllPaymentsTable();break}}startAutoUpdate(){this.updateTimer=setInterval(async()=>{try{await this.farmManager.updateFarms(),this.updateOverviewStats()}catch(e){console.error("Ошибка автообновления:",e)}},this.updateInterval)}stopAutoUpdate(){this.updateTimer&&(clearInterval(this.updateTimer),this.updateTimer=null)}}document.addEventListener("DOMContentLoaded",()=>{window.dashboard=new A});window.addEventListener("error",m=>{console.error("Глобальная ошибка:",m.error)});window.addEventListener("unhandledrejection",m=>{console.error("Необработанный промис:",m.reason)});
